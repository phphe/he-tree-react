import{J as Ee,r as p,j as ue}from"./index-Bdko82Ir.js";/*!
 * helper-js v3.1.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Re(t,e){return t<e?e:t}function Oe(t,e){return t<e?t:e}function Ne(t,e,o){return Oe(Re(t,e),o)}function Pe(t){return t[0]}function Ce(t){return t[t.length-1]}function Me(t,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=o&&o.withSelf?t:t.parentElement;for(;r;){const a=o.until&&r===o.until;if(a&&!o.withUntil)return;const u=e(r);if(u==="break")return;if(u)return r;if(a)return;r=r.parentElement}}function Le(t,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};o={start:0,end:t.length-1,maxTimes:1e3,...o};let{start:r,end:a}=o;const{returnNearestIfNoHit:u,maxTimes:h}=o;let s,i;r==null&&(r=0,a=t.length-1);let d=0,I;for(;r>=0&&r<=a;){if(d>=h)throw Error("binarySearch: loop times is over ".concat(h,", you can increase the limit."));s=Math.floor((a-r)/2+r),i=t[s];const w=d+1;if(I=e(i,s,w),I>0)a=s-1;else if(I<0)r=s+1;else return{index:s,value:i,count:w,hit:!0};d++}return u?{index:s,value:i,count:d+1,hit:!1,greater:I>0}:null}/*!
 * react-base-virtual-list
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Released under the MIT License.
 */const Ae=Ee.forwardRef,Ke={listSize:1e3,virtual:!0},ke=Ae(function(t,e){var o,r;const[a,u]=p.useState(t.itemSize||100),h=p.useMemo(()=>t.buffer||Math.max(a*5,100),[t.buffer,a]),s=t.items.length,i=p.useRef(null),d=p.useRef(null),I=p.useRef(0),w=p.useRef(),[K,P]=p.useState([]),[C,M]=p.useState(0),[x,R]=p.useState(t.listSize),[v,B]=p.useState([]),q=p.useRef(!1),W=p.useMemo(()=>{var N;const k=a*s;let L=C-h,j=k-C-x-h,J=0,Q=0;L<=0?(L=0,J=0):J=Math.floor(L/a),j<0&&(j=0),k<=x?Q=s:Q=s-Math.floor(j/a),t.virtual||(J=0,Q=s);let Z=Array.from({length:Q-J},(z,S)=>S+J).concat(t.persistentIndices||[]);return(N=t.persistentIndices)!=null&&N.length&&(Z=[...new Set(Z)].sort((z,S)=>z-S)),{visible:Z.map(z=>t.items[z]),visibleIndices:Z,topSpace:L,bottomSpace:j,totalSpace:k}},[t.items,a,s,C,h,x,t.virtual,t.persistentIndices]),{visible:G,visibleIndices:U,topSpace:m,bottomSpace:te,totalSpace:ie}=W,ce={paddingTop:`${m}px`,boxSizing:"border-box"};te<a*5?ce.paddingBottom=`${te}px`:ce.height=`${ie}px`,p.useLayoutEffect(()=>{if(i.current&&(R(i.current.clientHeight),t.itemSize==null)){const N=d.current;let k=parseFloat(getComputedStyle(N).rowGap);k=isNaN(k)?0:k;let L=0,j=0;const J=new Set(t.persistentIndices||[]);let Q=-1;for(const Z of N.children){if(Q++,J.has(U[Q]))continue;const z=getComputedStyle(Z);z.display!=="none"&&(z.position!=="static"&&z.position!=="relative"||(j+=Z.offsetHeight+parseFloat(z.marginTop)+parseFloat(z.marginBottom)+k,L++))}u(j/L)}},[t.itemSize,t.items,v]);const fe=function(N){var k;if(t.virtual&&!w.current){if(R(i.current.clientHeight),q.current)q.current=!1;else{const L=i.current.scrollTop;Math.abs(I.current-L)>(t.triggerDistance??a)&&(M(L),I.current=L)}(k=t.onScroll)==null||k.call(this,N)}};return p.useImperativeHandle(e,()=>({scrollToIndex(N,k="start"){w.current={index:N,block:k};const L=N*a;i.current.scrollTop=L,M(L),I.current=L,P([])},getRootElement(){return i.current},forceUpdate(){B([])}}),[a]),p.useLayoutEffect(()=>{if(w.current){const{index:N,block:k}=w.current;w.current=void 0;const L=U.indexOf(N),j=d.current.children[L];j&&(j.scrollIntoView({block:k}),q.current=!0)}},[K]),p.useLayoutEffect(()=>{const{ResizeObserver:N}=window,k=N&&new N(()=>{R(i.current.clientHeight)});return k==null||k.observe(i.current),()=>{k==null||k.disconnect()}},[]),ue.jsxs("div",{ref:i,onScroll:fe,className:t.className,style:{overflow:"auto",...t.style},children:[(o=t.renderHead)==null?void 0:o.call(t),ue.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",...t.virtual&&ce},children:G.map((N,k)=>t.renderItem(N,U[k]))}),(r=t.renderFoot)==null?void 0:r.call(t)]})});ke.defaultProps=Ke;const de={id:null,x:0,y:0,time:0},Be={idKey:"id",parentIdKey:"parent_id",childrenKey:"children",indent:20,dragOpen:!1,dragOpenDelay:600,placeholderId:"__DRAG_PLACEHOLDER__",dataType:"flat",direction:"ltr",rootId:null,virtual:!1};function Ve(t){const e={...Be,...t},{idKey:o,parentIdKey:r,childrenKey:a,placeholderId:u,isFunctionReactive:h}=e,s={idKey:o,parentIdKey:r};if(!e.renderNode&&!e.renderNodeBox)throw new Error("Either renderNodeBox or renderNode is required.");const i=e.direction==="rtl",d=p.useMemo(()=>e.openIds?[...e.openIds].sort().toString():void 0,[e.openIds]),I=p.useMemo(()=>new Set(e.openIds),[d]),w=p.useMemo(()=>e.checkedIds?[...e.checkedIds].sort().toString():"",[e.checkedIds]),K=p.useMemo(()=>new Set(e.checkedIds),[w]),P=p.useMemo(()=>{var he,pe;const S={},V={},H=[],$=[],Y=[],le=[];function*ge(){if(e.dataType==="flat")for(const n of e.data)yield[n];else for(const n of xe(e.data,a))yield n}let re=0;for(const[n,c]of ge()){const l=n[o]??re;le.push(l);let f=n[r];e.dataType==="tree"&&(f=((he=c.parent)==null?void 0:he[o])??null);let A=V[f]||null;const O=S[f]||null,D=[],g=[],b=[];let y,T,E;O?(y=O.childIds,T=O.children,E=O.childStats):(y=H,T=$,E=Y);const X=y.length,F=(O==null?void 0:O.level)+1||1,_={_isStat:!0,id:l,pid:f,childIds:D,siblingIds:y,node:n,parent:A,parentStat:O,children:g,childStats:b,siblings:T,siblingStats:E,index:X,level:F,open:e.openIds?I.has(l):!0,checked:K.has(l),draggable:!1};S[l]=_,V[l]=n,y.push(l),T.push(n),E.push(_),re++}for(const[n]of xe(Y,"childStats")){let c=((pe=e.canDrag)==null?void 0:pe.call(e,n))??null;c===null&&(c=n.parentStat?n.parentStat.draggable:!0),n.draggable=c}return{rootIds:H,rootNodes:$,rootStats:Y,allIds:le,getStat:n=>{let c;return typeof n=="object"?c=n._isStat?n.id:n[o]:c=n,S[c]}}},[e.data,e.dataType,o,r,I,K,h&&e.canDrag]),{rootIds:C,rootStats:M,getStat:x}=P,R=e.indent,[v,B]=p.useState(),[q,W]=p.useState(),G=p.useRef(null),U=p.useRef(null),[m,te]=p.useState(),ie=!v,ce=p.useMemo(()=>{const S=[],V=[];for(const[n,{skipChildren:c}]of xe(M,"childStats")){const l=H(n);n===v&&(Object.assign(l.style,{position:"fixed",top:0,left:0,pointerEvents:"none",zIndex:"-999999999",visibility:"hidden"}),l["data-dragging"]=!0),V.push(l),S.push(n.id),(!n.open||n===v)&&c()}if(m){const c=((f,A)=>{let O=((f==null?void 0:f.childStats)||M)[A],D;if(O)D=S.indexOf(O.id);else{const g=y=>y.siblingStats[y.siblingStats.indexOf(y)+1];let b;if(f){for(const y of we(f,"parentStat",{withSelf:!0}))if(b=g(y),b)break}b?D=S.indexOf(b.id):D=S.length}return D})(m.parentStat,m.index);S.splice(c,0,u);const l=H({id:u,level:m.level},!0);l["data-drag-placeholder"]=!0,V.splice(c,0,l)}function H(n,c=!1){return{key:n.id,draggable:n.draggable,style:{[`padding${i?"Right":"Left"}`]:(n.level-1)*R+"px"},"data-key":n.id+"","data-level":n.level+"","data-node-box":!0,onDragStart(l){var D;if(c){l.preventDefault();return}let f;const A=Me(l.target,g=>(!f&&g.hasAttribute("draggable")&&(f=g),g.hasAttribute("data-node-box")),{withSelf:!0});if(A.querySelector("[draggable]")&&f===A){l.preventDefault();return}if(l.dataTransfer.setData("text/plain","he-tree he-tree-react"),l.dataTransfer.dropEffect="move",e.customDragImage)e.customDragImage(l,n);else{const g=A.children[0];l.dataTransfer.setDragImage(g,i?g.offsetWidth:0,0)}setTimeout(()=>{var g;B(n),te({...m,parentStat:n.parentStat,level:n.level,index:(((g=n.parentStat)==null?void 0:g.childIds)||C).indexOf(n.id)})},0),(D=e.onDragStart)==null||D.call(e,l,n)},onDragLeave(l){}}}const $=n=>{var A,O,D;if(ie&&!((A=e.onExternalDragOver)!=null&&A.call(e,n)))return;const c=l();if(c){const g=x(c.getAttribute("data-key")),b=!!c.getAttribute("data-drag-placeholder");f(g,b)&&e.onDragOpen(g);let y=Se(g,b);const{closest:T,next:E}=y;let{atTop:X}=y;const F=U.current,_=c;let ye=(()=>{let oe=_.getBoundingClientRect(),ee;return i?ee=Math.ceil((oe.right-n.clientX)/R):ee=Math.ceil((n.clientX-oe.x)/R),Ne(ee,0,((T==null?void 0:T.level)||0)+1)})();if(!X&&!b&&T.id===C[0]){const oe=F.querySelector(`[data-key="${T.id}"]`);if(oe){const ee=oe.getBoundingClientRect();X=ee.y+ee.height/2>n.clientY}}X&&(ye=0);let Ie;if(X)re(null,0)&&(Ie={...m,parentStat:null,level:1,index:0});else{const oe=E?E.level-1:0,ee=[],me=[];let ne=T;const De=()=>ne?ne.level:0;for(;De()>=oe;){const be=he(ne,E);if(re(ne,be)&&(ye>De()?ee:me).unshift({parentStat:ne,index:be}),!ne)break;ne=ne.parentStat}let se=Ce(ee);se||(se=Pe(me)),se&&(Ie={...m,parentStat:se.parentStat,level:(((O=se.parentStat)==null?void 0:O.level)??0)+1,index:se.index})}te(Ie),Ie&&n.preventDefault(),W(b?void 0:g),(D=e.onDragOver)==null||D.call(e,n,g,ie)}else re(null,0)&&(te({...m,parentStat:null,level:1,index:0}),n.preventDefault());function l(){const b=U.current.querySelectorAll("[data-node-box]:not([data-dragging])"),y=Le(b,E=>E.getBoundingClientRect().top-n.clientY,{returnNearestIfNoHit:!0});let T;return y.hit||y.greater&&(T=y.index-1,T<0&&(T=0)),T==null&&(T=y.index),b[T]}function f(g,b){if(!e.dragOpen||b||g.open)return!1;const y=()=>Object.assign(de,{id:g.id,x:n.clientX,y:n.clientY,time:Date.now()});if(de.id!==g.id||ze(n.clientX,n.clientY,de.x,de.y)>10)return y(),!1;if(Date.now()-de.time>=e.dragOpenDelay)return!0}},Y=n=>{var c,l;if(!(ie&&!((c=e.onExternalDragOver)!=null&&c.call(e,n)))&&m&&(n.preventDefault(),ie)){const{index:f}=m;(l=e.onExternalDrop)==null||l.call(e,n,m.parentStat,f),ge()}};function le(n){var f,A;if(!v)return;let c=!m;if(!c){let D=U.current.getBoundingClientRect();c=!(n.clientX>=D.left&&n.clientX<=D.right&&n.clientY>=D.top&&n.clientY<=D.bottom)}if(!(((f=e.onDragEnd)==null?void 0:f.call(e,n,v,c))===!1)&&m){let O=m.index;m.parentStat===v.parentStat&&v.index<O&&O--;const D=[...e.data];if(e.dataType==="flat"){const g=((A=m.parentStat)==null?void 0:A.id)??e.rootId,b=Fe(D,v.id,s),y={...v.node,[r]:g};b[0]=y;const T=Te(D,g,O,s);D.splice(T,0,...b)}else{const g=new Map,b=E=>{if(!E)return D;const X=b(E.parentStat);let F=[...E.children];const _=g.get(E.node)||{...E.node,[a]:F};return g.set(E.node,_),F=_[a],X[E.index]=_,F},y=b(v.parentStat),T=m.parentStat===v.parentStat?y:b(m.parentStat);y.splice(v.index,1),T.splice(O,0,v.node)}e.onChange(D)}ge()}function ge(){W(void 0),B(void 0),te(void 0)}function re(n,c){var f,A;if(!n)return((f=e.canDropToRoot)==null?void 0:f.call(e,c))??!0;if(!n.open)return!1;let l=(A=e.canDrop)==null?void 0:A.call(e,n,c);return l==null&&(l=re(n.parentStat)),l}function Se(n,c){let l=n,f=S.indexOf(c?e.placeholderId:n.id),A=!1;const O=E=>E===u||x(E)===v,D=(E,X)=>{let F=E,_;do F+=X,_=S[F];while(_&&O(_));return{id:_,i:F}},g=(E,X)=>{const F=D(E,X);l=x(F.id),f=F.i},b=1;c&&(g(f,-1),l||(A=!0,g(-1,b)));const T=x(D(f,b).id);return{closest:l,atTop:A,next:T}}function he(n,c){const l=n?n.childStats:M;let f=l.length;return c&&c.siblingStats===l&&(f=l.indexOf(c)),f}function pe(n,c="start"){const l=x(n);if(!l)return!1;let f=S.indexOf(l.id);return f===-1?!1:G.current?(G.current.scrollToIndex(f,c),!0):!1}return{visibleIds:S,attrsList:V,onDragOverRoot:$,onDropToRoot:Y,onDragEndOnRoot:le,scrollToNode:pe}},[P,R,v,m==null?void 0:m.parentStat,m==null?void 0:m.index,R,u,i,e.rootId,...[e.canDrop,e.canDropToRoot,e.customDragImage,e.onDragStart,e.onDragOver,e.onExternalDragOver,e.onExternalDrop,e.onDragEnd,e.onChange,e.onDragOpen].map(S=>h&&S)]),fe=p.useMemo(()=>({getEl:()=>window,onDragOverWindow:S=>{V()||(W(void 0),e.keepPlaceholder||te(void 0));function V(){let H=!1,$=S.target;if($){for(const Y of we($,"parentElement",{withSelf:!0}))if(Y===U.current){H=!0;break}}return H}}}),[e.keepPlaceholder]);He(fe.getEl,"dragover",fe.onDragOverWindow);const{visibleIds:N,attrsList:k,onDragOverRoot:L,onDropToRoot:j,onDragEndOnRoot:J,scrollToNode:Q}=ce,Z=p.useMemo(()=>v?[N.indexOf(v.id)]:[],[v,N]),z=S=>{let V=e.renderNodeBox;if(!V){const H=ue.jsx("div",{className:"he-tree-drag-placeholder",style:{minHeight:"20px",border:"1px dashed blue"}});V=({stat:$,attrs:Y,isPlaceholder:le})=>p.createElement("div",{...Y,key:Y.key},le?H:e.renderNode($))}return ue.jsx("div",{className:`he-tree ${(S==null?void 0:S.className)||""}`,style:S==null?void 0:S.style,ref:U,onDragOver:L,onDrop:j,onDragEnd:J,children:ue.jsx(ke,{ref:G,items:N,virtual:e.virtual,persistentIndices:Z,style:{height:"100%"},renderItem:(H,$)=>V({stat:x(H),attrs:k[$],isPlaceholder:H===u})})})};return{...P,visibleIds:N,attrsList:k,virtualListRef:G,draggingStat:v,dragOverStat:q,placeholder:m,renderTree:z,renderHeTree:z,scrollToNode:Q}}function*xe(t,e="children"){let o=!1,r=!1;const a=()=>{o=!0},u=()=>{r=!0};yield*h(t,null,[]);function*h(s,i,d){let I=0;for(const w of s){if(yield[w,{parent:i,parents:d,siblings:s,index:I,skipChildren:a,exitWalk:u}],r)return;if(I++,o)o=!1;else{const P=w[e];if(P&&(yield*h(P,w,[...d,w]),r))return}}}}function Xe(t,e,o="children"){for(const r of xe(t,o))if(e(...r))return r[0]}function*we(t,e,o={withSelf:!1}){let r=t;for(;r;)(r!==t||o.withSelf)&&(yield r),r=typeof e=="function"?e(r):r[e]}function We(t,e){const o={...ae,...e},{idKey:r,parentIdKey:a}=o,u=new Map;u.set(null,[]);const h=u.get(null);for(const i of t){const d=i[r];u.set(d,[])}for(const i of t){const d=i[a];(u.get(d)||h).push(i)}function*s(i){for(const d of i){yield d;const I=d[r];yield*s(u.get(I))}}return[...s(h)]}const ae={idKey:"id",parentIdKey:"parent_id"};function*ve(t,e){const o={...ae,...e},{idKey:r,parentIdKey:a}=o;let u=!1,h=!1;const s=()=>{u=!0},i=()=>{h=!0},d={},I={},w={},K=[];let P,C=0;for(const M of t){const x=M[r],R=M[a]??null;d[x]=M;const v=d[R]||null;w[x]=[];const B=v?w[R]:K,q=B.length;B.push(x);const W={parent:v,parents:v?[...I[R].parents,v]:[],index:q,id:x,pid:R,treeIndex:C,skipChildren:s,exitWalk:i};I[x]=W;let G=!1;if(u&&P&&(P.has(R)?(P.add(x),G=!0):(u=!1,P=void 0)),!G){if(yield[M,W],h)break;u&&(P=new Set([x]))}C++}}function Te(t,e,o,r){const a={...ae,...r},{idKey:u,parentIdKey:h}=a;let s=!1,i=-1;for(const[d,{treeIndex:I,skipChildren:w,index:K}]of ve(t,a))if(e!=null&&!s)d[u]===e&&(s=!0);else if(e==null||d[h]===e)if(o!=null&&o===K){i=I;break}else w();else{i=I;break}return i===-1&&(i=t.length),i}function $e(t,e,o,r){const a={...ae,...r},{idKey:u,parentIdKey:h}=a,s=e[h]??null,i=Te(t,s,o,a);t.splice(i,0,e)}function Fe(t,e,o){if(e==null)return t.splice(0,t.length);const r={...ae,...o},{idKey:a,parentIdKey:u}=r;let h=-1,s=-1;for(const[i,{treeIndex:d,skipChildren:I}]of ve(t,r))if(h===-1)i[a]===e&&(h=d,I());else{s=d;break}return s===-1&&(s=t.length),h===-1?[]:t.splice(h,s-h)}function Ye(t,e,o,r){const a={...ae,...r},{idKey:u,parentIdKey:h}=a,s=new Set(e),i=Array.isArray(o)?o:[o],d=new Set(i);if(d.size>0)for(const[I,{parents:w}]of ve(t,a)){const K=I[u];if(d.has(K)){for(const P of w)s.add(P[u]);if(d.delete(K),d.size===0)break}}return Array.from(s).sort()}function qe(t,e,o,r,a){const u=new Set(e),h=Array.isArray(o)?o:[o],s=new Map,i=new Set(h),d=new Map,I=[];d.set(null,I);for(const[C,{parents:M,id:x,pid:R}]of ve(t,a))d.get(R).push(x),d.set(x,[]),s.set(x,u.has(x)),(i.has(x)||R&&i.has(R))&&(s.set(x,r),i.add(x));const w=C=>{const M=d.get(C);if(!M||M.length===0)return s.get(C);let x=!1,R=!1,v=!1;for(const q of M){let W=w(q);W===!1?R=!0:W===null?v=!0:x=!0}let B;return v||R&&x?B=null:R?B=!1:B=!0,s.set(C,B),B};for(const C of I)w(C);const K=[],P=[];return s.forEach((C,M)=>{C===!0?K.push(M):C===null&&P.push(M)}),[K.sort(),P.sort()]}function ze(t,e,o,r){return Math.sqrt(Math.pow(o-t,2)+Math.pow(r-e,2))}function He(t,e,o){p.useLayoutEffect(()=>{const r=t();return r==null||r.addEventListener(e,o),()=>{r==null||r.removeEventListener(e,o)}},[t,e,o])}export{qe as a,$e as b,Xe as f,Ye as o,Fe as r,We as s,Ve as u};
